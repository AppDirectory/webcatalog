const{session}=require('electron'),fs=require('fs'),path=require('path'),extractDomain=(a)=>{const b=a.match(/^https?:\/\/([^/?#]+)(?:[/?#]|$)/i),c=b&&b[1];return c},registerFiltering=(a)=>{const{AdBlockClient:b,FilterOptions:c}=require('ad-block'),d=path.join(__dirname,'easylist+easyprivacy-noelementhiding.txt');fs.readFile(d,'utf8',(e,f)=>{if(e)return;const g=new b;g.parse(f),session.fromPartition(`persist:${a}`).webRequest.onBeforeRequest((h,i)=>{return(h.url.startsWith('http://')||h.url.startsWith('https://'))&&'mainFrame'!==h.resourceType?g.matches(h.url,c.script,extractDomain(h.referrer))?void i({cancel:!0,requestHeaders:h.requestHeaders}):void i({cancel:!1,requestHeaders:h.requestHeaders}):void i({cancel:!1,requestHeaders:h.requestHeaders})})})};module.exports=registerFiltering;